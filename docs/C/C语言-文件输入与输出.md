# C语言— —文件输入与输出

本文主要介绍如何在C语言中操作文件。



## 1. 文件与IO流

很多教程都说文件分为文本文件和二进制文件，那如何区分是文本文件还是二进制文件呢？现有如下的数据文件：

![image-20220226184918219](img/C语言-文件输入与输出/image-20220226184918219.png)

你说它是文本文件还是二进制文件呢？

计算机存储数据，都是以二进制的形式存储。所以，在我看来，文件并没有文本文件和二进制文件的区分。

在C语言中，每个文件对应着一个数据流，这个流分为文本流和二进制流。所谓二进制流，你可以把它看成是一长串`0、1`字符串；所谓文本流，你可以把它看成是一长串字符，字符可能为`a`，`,`等。文本流就是在二进制流的基础上，加上编码，将二进制字符串解释为字符。

对于文件操作，我们可以按照如下三个步骤进行操作：

- 打开文件：所谓打开文件，就是创建一个流，使用函数`fopen()`创建流；
- 操作流：打开文件后，我们就得到了一个流，我们可以对这个流进行读数据或写数据；
- 关闭流：当操作完成后，我们需要关闭流，使用函数`fclose()`关闭流；



## 2. 操作文件的函数

### 2.1 创建流

创建流的函数是`fopen()`，函数声明如下：

```c
FILE * fopen ( const char * filename, const char * mode );
```

该函数需要两个参数：

- 第一个参数`filename`表示要打开的文件路径，可以包含目录名，如果不包含路径就表示程序运行的当前目录。
- 第二个参数`mode`表示创建流的模式，**如果创建的是文本流**，有如下值：
    - `r`：是`read`的缩写，表示打开文件用于读取文件中的内容。该模式要求文件必须存在。
    - `w`：是`write`的缩写，表示打开文件用于写入内容（覆盖）。如果`filename`不存在，则创建新文件并写入内容；如果`filename`存在，则会覆盖原文件内容。
    - `a`：是`append`的缩写，表示打开文件并写入内容（追加），与`w`模式最大的不同就是`a`会在原文件内容的末尾追加写入新的内容，并不会覆盖原内容。如果文件不存在，则会创建新文件。
    - `r+`：是`read/update`的含义，表示打开文件用于读和写。该模式要求文件必须存在。
    - `w+`：是`write/update`的含义，表示打开文件用于读和写。如果`filename`不存在，则创建新文件并写入内容；如果`filename`存在，则会覆盖原文件内容。
    - `a+`：是`append/update`的含义，表示打开文件用于读和追加写。如果文件不存在，则会创建新文件。
- 第二个参数`mode`还有另外一组值，**如果创建的是二进制流**，那么分别是`rb`，`wb`，`ab`，`rb+`，`wb+`，`ab+`；

该函数返回`FILE *`类型，用于访问一个流。



### 2.2 操作流

流分为文本流和二进制流，所以此处也分开讲这两种流的操作。

#### 2.2.1 操作文本流





#### 2.2.2 操作二进制流

二进制流的读取使用函数`fread()`，写入数据到二进制流中使用函数`fwrite()`，函数声明如下：

```c
size_t fread ( void * ptr, size_t size, size_t count, FILE * stream );
size_t fwrite ( const void * ptr, size_t size, size_t count, FILE * stream );
```

- `ptr`是一个指向用于保存数据的内存位置的指针；
- `size`是每个元素的字节数；
- `count`是要写入多少个元素；
- `stream`是要读取或写入的流；
- 函数返回值是实际读取或写入的元素数目（不是字节数），如果输入过程中遇到了文件结尾或输出过程中出现了错误，这个数字可能比请求的元素数目小；





### 2.3 关闭流

关闭流的函数是`fclose()`，函数声明如下：

```c
int fclose ( FILE * stream );
```

该函数接受一个`FILE`指针类型参数`stream`，表示需要关闭的流。如果流成功关闭，则返回0；否则，返回`EOF`（-1）。



## 3. 刷新和定位函数





## 参考资料